# Custom PostgreSQL configuration for Citus, pg_partman, and pg_cron
# This file is loaded automatically by PostgreSQL and extends the default configuration

# Load required extensions at startup
shared_preload_libraries = 'citus,pg_cron,pg_partman_bgw'

# pg_cron configuration - use postgres database for cron metadata
cron.database_name = 'postgres'

# Performance tuning for distributed workloads
max_connections = 2000
shared_buffers = 256MB
effective_cache_size = 1GB
work_mem = 4MB
maintenance_work_mem = 64MB

# WAL configuration for better performance
wal_level = replica
max_wal_size = 2GB
min_wal_size = 80MB
checkpoint_completion_target = 0.9

# Connection and statement timeout settings
statement_timeout = 300000  # 5 minutes
idle_in_transaction_session_timeout = 600000  # 10 minutes

# Logging configuration for debugging
log_destination = 'stderr'
log_min_duration_statement = 1000  # Log slow queries (>1s)
log_checkpoints = on
log_connections = on
log_disconnections = on
log_lock_waits = on